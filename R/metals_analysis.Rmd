---
title: "metals_analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(readr)

ICPMS_Data <- read_csv("data/ICPMS_Data.csv", skip=1, na = "N/A")
view(ICPMS_Data)
Sample_Key <- read_csv("data/Sample_Key.csv",skip=0)

### tidying process for ICPMS_Data:
RSD_data <- ICPMS_Data %>%
select(Cr52 = `CPS RSD`,
      Cr53 = `CPS RSD_1`,
      As75 = `CPS RSD_2`,
      Cd111 = `CPS RSD_3`,
      Cd114 = `CPS RSD_4`,
      Pb208 = `CPS RSD_5`,
      Ge_RSD= `CPS RSD_7`,
      `Sample Key`) %>%
  pivot_longer(1:6,
               names_to = "metal",
               values_to = "RSD")
 
ICPMS_tidy <- ICPMS_Data %>% 
  select(Cr52 = CPS,
         Cr53 = CPS_1,
         As75 = CPS_2,
         Cd111 = CPS_3,
         Cd114 = CPS_4,
         Pb208 = CPS_5,
         Ge72 = CPS_7,
         `Sample Key`) %>%
  pivot_longer(1:6,
               names_to = "metal",
               values_to = "CPS") %>%
  mutate(RSD = RSD_data$RSD/RSD_data$Ge_RSD,CPS=CPS/Ge72) %>%
  select(-Ge72)
view(ICPMS_tidy)

all(RSD_data$`Sample Key`==ICPMS_tidy$`Sample Key`,RSD_data$metal==ICPMS_tidy$metal) ### returns true if data matches

merged_ICPMS <- merge(ICPMS_tidy,Sample_Key)
view(merged_ICPMS)

### Tidying process for Cr AA_data:
AA_Data <- read_csv("data/AA_Data.csv",skip=4,na = "N/A")
view(AA_Data)

AA_RSD <- AA_Data %>%
  gather(`%RSD`, key = "Sample",value = "RSD") 

AA_tidy <- AA_Data %/%
  gather(X2, key = "Sample",value = "ABS") %>%
  select(X2,sample,ABS) %>%
  mutate(RSD = AA_RSD$RSD)

AA_merged <- merge(AA_tidy,Sample_Key)
view(AA_merged)
  

 
```

